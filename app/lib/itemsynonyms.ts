// ğŸ“„ app/lib/itemsynonyms.ts

/**
 * í’ˆëª©/ë¸Œëœë“œ/í’ˆì¢… ë™ì˜ì–´ ì‚¬ì „
 * - ì‚¬ëŒì´ ì“°ëŠ” í‘œí˜„ â†’ ì‹œìŠ¤í…œì´ ì´í•´í•˜ëŠ” í‘œì¤€ í‚¤ì›Œë“œ
 * - resolveItems.tsì—ì„œ ì ìˆ˜ ê³„ì‚° ì „ì— ì ìš©ë¨
 * - ì—¬ê¸°ì„œëŠ” "ì˜ë¯¸ ì¹˜í™˜"ë§Œ ë‹´ë‹¹ (ì •ê·œí™”ëŠ” resolveItemsì—ì„œ)
 */

/* ================= ê³µí†µ ì •ê·œí™” (ë¡œì»¬) ================= */
function normLocal(s: string) {
  return String(s || "")
    .toLowerCase()
    .replace(/\s+/g, "")
    .replace(/[()\-_/.,]/g, "");
}

/* ================= í•˜ë“œì½”ë”© ë™ì˜ì–´ ================= */
export const ITEM_SYNONYMS: Record<string, string> = {
  /* ===== í’ˆì¢… ===== */
  "ì¹´ì‡¼": "ì¹´ë² ë¥´ë„¤ ì†Œë¹„ë‡½",
  "ì¹´ì‡¼ë„¤": "ì¹´ë² ë¥´ë„¤ ì†Œë¹„ë‡½",
  "ì¹´ì‡¼ì†Œë¹„ë‡½": "ì¹´ë² ë¥´ë„¤ ì†Œë¹„ë‡½",
  "ì¹´ë² ë¥´ë„¤": "ì¹´ë² ë¥´ë„¤ ì†Œë¹„ë‡½",

  "ìƒ¤ë„": "ìƒ¤ë¥´ë„ë„¤",
  "ìƒ¤ë„ë„¤": "ìƒ¤ë¥´ë„ë„¤",
  "ìƒ¤ë„ë„¤ì´": "ìƒ¤ë¥´ë„ë„¤",

  "í”¼ë…¸": "í”¼ë…¸ ëˆ„ì•„",
  "ì‚ë…¸": "í”¼ë…¸ ëˆ„ì•„",

  "ì†Œë¹„ë‡½": "ì†Œë¹„ë‡½ ë¸”ë‘",

  /* ===== ë¸Œëœë“œ ì•½ì–´ ===== */
  "ë¡œì‰¬ë²¨ë Œ": "BL",
  "ë£¨ì´ë¯¸ì…€": "LM",
  "ë£¨ì´ë¯¸ì‰˜": "LM",
  "ë£¨ì´ ë¯¸ì‰˜": "LM",

  /* ===== ë“±ê¸‰ ===== */
  "í”„ë¦¬ë¯¸ì—í¬ë¤¼": "1ER CRU",
  "í”„ë¦¬ë¯¸ì— í¬ë¤¼": "1ER CRU",
  "ê·¸ë‘í¬ë¤¼": "GRAND CRU",
  "ê·¸ë‘í¬ë£¨": "GRAND CRU",
};

/**
 * ì…ë ¥ ë¬¸ìì—´ì— ë™ì˜ì–´ ì ìš©
 * - ë„ì–´ì“°ê¸°/ëŒ€ì†Œë¬¸ì/íŠ¹ìˆ˜ë¬¸ì ì°¨ì´ë¥¼ í—ˆìš©
 * - ê¸´ í‚¤ë¶€í„° ì¹˜í™˜ (ê²¹ì¹¨ ë°©ì§€)
 *
 * ex)
 *  "ë¡œì‰¬ ë²¨ë Œ ìƒ¤ë¸”ë¦¬ í”„ë¦¬ë¯¸ì— í¬ë¤¼"
 *   â†’ "BL ìƒ¤ë¸”ë¦¬ 1ER CRU"
 */
export function applyItemSynonym(input: string) {
  let s = String(input || "");
  let n = normLocal(s);

  const entries = Object.entries(ITEM_SYNONYMS)
    .map(([k, v]) => ({
      key: k,
      value: v,
      nkey: normLocal(k),
    }))
    .sort((a, b) => b.nkey.length - a.nkey.length);

  for (const e of entries) {
    if (e.nkey && n.includes(e.nkey)) {
      // ì›ë³¸ ë¬¸ìì—´ ê¸°ì¤€ìœ¼ë¡œ ì¹˜í™˜
      s = s.replace(new RegExp(e.key, "gi"), e.value);
      n = normLocal(s); // ğŸ”¥ ì¹˜í™˜ í›„ ì¬ì •ê·œí™”
    }
  }

  return s;
}
